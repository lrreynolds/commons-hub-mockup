<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Commonshub — Dashboard</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body class="dashboard">

  <div class="wrap">
    <aside class="sidebar">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <b>Commonshub</b>
          <span>Owner dashboard (mock)</span>
        </div>
      </div>

      <!-- Keep sidebar calm: one nav item always -->
      <nav class="nav" aria-label="Dashboard sections">
        <a class="navItem active" href="#status">
          <div>
            <b>Status</b><br>
            <small id="navSubtitle">Live + next step</small>
          </div>
          <div>●</div>
        </a>
      </nav>

      <div class="hint">
        <b>Mock only:</b> Commonshub is the control plane (hosting, invites, community funding).
        Conversations and moderation happen in Mastodon.
      </div>

      <div class="muted" style="margin-top:10px; font-size:13px;">
        <a href="index.html" style="color:inherit; text-decoration:none;">← Back to start</a>
      </div>
    </aside>

    <main class="stage">
      <div class="topbar">
        <div class="left">
          <div class="logoMark"></div>
          <div class="meta">
            <b>Commons Dashboard</b>
            <span>Stewardship + hosting</span>
          </div>
        </div>

        <div class="chip">Owner view</div>

        <a class="secondary" href="#" data-reset="all" style="width:auto;">
          Start over
        </a>
      </div>

      <div class="content">
        <div class="center">

          <div class="header">
            <div>
              <h2>Your community is live</h2>
              <p id="headerSubcopy">
                Your server is running. Next, we’ll help you make it feel “real” before you invite anyone.
              </p>
            </div>
            <div class="chip">Status: Live</div>
          </div>

          <!-- ========================= -->
          <!-- PRE-SETUP (wizard not done) -->
          <!-- ========================= -->
          <div id="preSetup">
            <section id="status" style="scroll-margin-top:90px;">
              <div class="card">
                <h3>Community status</h3>
                <div class="muted">Role: Community owner</div>

                <div class="list" style="margin-top:10px;">
                  <div class="item">
                    <b>Community</b>
                    <div class="muted">The Commons Hub · mycommunity.commonshub.social</div>
                  </div>
                  <div class="item">
                    <b>Hosting</b>
                    <div class="muted">Active · Managed by Commonshub</div>
                  </div>
                  <div class="item">
                    <b>Members</b>
                    <div class="muted">0 (expected)</div>
                  </div>
                </div>

                <div class="note" style="margin-top:12px;">
                  <b>Next:</b> Run a 3-step setup (branding, purpose, welcome post). ~5 minutes.
                </div>

                <div class="footerBar" style="margin-top:12px;">
                  <a class="primary" href="setup-wizard.html">Set up your community</a>
                </div>
              </div>
            </section>
          </div>

          <!-- ========================= -->
          <!-- POST-SETUP (wizard done)  -->
          <!-- ========================= -->
          <div id="postSetup" style="display:none;">
            <section id="status" style="scroll-margin-top:90px;">
              <div class="card">

                <h3>Ready to invite</h3>
                <div class="muted" style="margin-top:2px;">
                  You’ll post and interact in Mastodon. Commonshub handles hosting, invites, and community funding.
                </div>

                <div class="list" style="margin-top:12px;">
                  <div class="item">
                    <b>Community</b>
                    <div class="muted">The Commons Hub · mycommunity.commonshub.social</div>
                  </div>
                  <div class="item">
                    <b>Hosting</b>
                    <div class="muted">Active · Managed by Commonshub</div>
                  </div>
                  <div class="item">
                    <b>Members</b>
                    <div class="muted">0 (expected)</div>
                  </div>
                </div>

                <!-- Primary actions: ONLY visit + invite -->
                <div class="footerBar" style="margin-top:14px; gap:12px;">
                  <a class="primary" href="community.html" style="flex:1; justify-content:center;">
                    Visit community (Mastodon)
                  </a>

                  <button class="secondary" id="copyInviteBtn" type="button"
                          style="flex:1; width:auto; justify-content:center;">
                    Copy invite link
                  </button>
                </div>

                <!-- Invite link stays hidden unless the user wants it -->
                <div class="field" id="inviteField" style="margin-top:12px; display:none;">
                  <label>Invite link</label>
                  <input
                    id="inviteLink"
                    type="text"
                    value="https://mycommunity.commonshub.social/invite/abc123"
                    readonly
                  />
                  <div class="muted" style="margin-top:6px;">
                    Share this link wherever your audience already is (Substack, YouTube, email, etc.).
                  </div>
                </div>

                <!-- Community funding block (zen) -->
                <div class="card" style="margin-top:14px; background:var(--card2);">
                  <h3 style="margin:0 0 6px;">Community funding</h3>
                  <div class="muted" id="fundingSubcopy">
                    Optional. Participation is always free.
                  </div>

                  <!-- Status lines (quiet) -->
                  <div class="list" style="margin-top:12px;">
                    <div class="item">
                      <b>Stripe</b>
                      <div class="muted" id="stripeStatus">Not connected</div>
                    </div>
                    <div class="item">
                      <b>Community funding</b>
                      <div class="muted" id="fundingStatus">Off</div>
                    </div>
                  </div>

                  <!-- STATE A/B CTA (single large button) -->
                  <div id="fundingCtaWrap" class="footerBar" style="margin-top:14px;">
                    <a class="primary" id="fundingPrimaryBtn" href="funding-start.html">
                      Enable community funding
                    </a>
                  </div>

 <div id="fundingLiveActions" style="display:none;">
  <div class="footerBar" style="margin-top:14px; gap:12px;">
    <a class="secondary"
       id="fundingPreviewBtn"
       href="community-funding.html"
       style="flex:1; width:auto; justify-content:center;">
      Visit community funding page
    </a>

    <button class="secondary"
            id="copyFundingLinkBtn"
            type="button"
            style="flex:1; width:auto; justify-content:center;">
      Copy community funding link
    </button>
  </div>

  <div class="muted" style="margin-top:10px; font-size:13px;">
    <a href="funding-start.html" style="color:inherit; text-decoration:none;">
      Manage community funding
    </a>
  </div>

  <div class="field" id="fundingLinkField" style="margin-top:12px; display:none;">
    <label>Community funding link</label>
    <input
      id="fundingLinkInput"
      type="text"
      value="https://mycommunity.commonshub.social/funding"
      readonly
    />
  </div>
</div>

                  <!-- Funding link field (only revealed when copy clicked, and only in State C) -->
                  <div class="field" id="fundingLinkField" style="margin-top:12px; display:none;">
                    <label>Community funding link</label>
                    <input
                      id="fundingLink"
                      type="text"
                      value="https://mycommunity.commonshub.social/fund"
                      readonly
                    />
                    <div class="muted" style="margin-top:6px;">
                      Share this link anywhere. (This page also invites people to join your community.)
                    </div>
                  </div>
                </div>

                <!-- Details toggle (everything else is hidden by default) -->
                

               
                </div>

              </div>
            </section>
          </div>

        </div>
      </div>
    </main>
  </div>

  <script src="assets/app.js"></script>

  <script>
    // Dashboard-only: Community funding state rendering (A/B/C)
    (() => {
      const stripeStatus = document.getElementById("stripeStatus");
      const fundingStatus = document.getElementById("fundingStatus");
      const fundingSubcopy = document.getElementById("fundingSubcopy");

      const fundingPrimaryBtn = document.getElementById("fundingPrimaryBtn");
      const fundingCtaWrap = document.getElementById("fundingCtaWrap");

      const fundingLiveActions = document.getElementById("fundingLiveActions");
      const manageFundingBtn = document.getElementById("manageFundingBtn");

      const copyFundingBtn = document.getElementById("copyFundingBtn");
      const fundingLinkField = document.getElementById("fundingLinkField");
      const fundingLinkInput = document.getElementById("fundingLink");

      if (!stripeStatus || !fundingStatus || !fundingPrimaryBtn) return;

      let stripeConnected = false;
      let fundingEnabled = false;

      try {
        stripeConnected = localStorage.getItem("commonshub_stripe_connected") === "1";
        fundingEnabled  = localStorage.getItem("commonshub_funding_enabled") === "1";
      } catch {}

      // STATE A: Stripe not connected => funding cannot be on
      if (!stripeConnected) {
        stripeStatus.textContent = "Not connected";
        fundingStatus.textContent = "Off";
        if (fundingSubcopy) {
          fundingSubcopy.textContent =
            "Optional. Participation is always free. Connect Stripe to enable community funding.";
        }

        fundingPrimaryBtn.textContent = "Enable community funding";
        fundingPrimaryBtn.href = "funding-start.html";

        if (fundingLiveActions) fundingLiveActions.style.display = "none";
        if (fundingLinkField) fundingLinkField.style.display = "none";
        return;
      }

      // Stripe connected:
      stripeStatus.textContent = "Connected";

      // STATE B: Stripe connected, funding off
      if (!fundingEnabled) {
        fundingStatus.textContent = "Off";
        if (fundingSubcopy) {
          fundingSubcopy.textContent =
            "Stripe is connected. Turn on community funding when you’re ready.";
        }

        fundingPrimaryBtn.textContent = "Turn on community funding";
        fundingPrimaryBtn.href = "funding-options.html";

        if (fundingLiveActions) fundingLiveActions.style.display = "none";
        if (fundingLinkField) fundingLinkField.style.display = "none";
        return;
      }

      // STATE C: funding live (assumes pinned post/banner completed in your flow)
      fundingStatus.textContent = "Live";
      if (fundingSubcopy) {
        fundingSubcopy.textContent =
          "Community funding is live and shareable.";
      }

      // Hide single CTA; show two actions
      if (fundingCtaWrap) fundingCtaWrap.style.display = "none";
      if (fundingLiveActions) fundingLiveActions.style.display = "flex";

      if (manageFundingBtn) manageFundingBtn.href = "funding-options.html";

      async function copyText(text) {
        try { await navigator.clipboard.writeText(text); return true; }
        catch { return false; }
      }

      if (copyFundingBtn && fundingLinkInput) {
        copyFundingBtn.addEventListener("click", async () => {
          if (fundingLinkField) fundingLinkField.style.display = "block";

          fundingLinkInput.focus();
          fundingLinkInput.select();

          const ok = await copyText(fundingLinkInput.value);
          if (!ok) {
            try { document.execCommand("copy"); } catch {}
          }

          const old = copyFundingBtn.textContent;
          copyFundingBtn.textContent = "Copied";
          setTimeout(() => (copyFundingBtn.textContent = old), 900);
        });
      }
    })();
  </script>

</body>
</html>
